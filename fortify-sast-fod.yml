fortify-sast-fod:
  image: dylanbthomas/fortify-ci-tools-test:1600275150
  variables:
    PACKAGE_OPTS: "-bt mvn"
    FOD_URL: "https://ams.fortify.com"
    FOD_API_URL: "https://api.ams.fortify.com/"
    FOD_UPLOADER_OPTS: "-ep 4"
    FOD_NOTES: "Triggered by Gitlab Pipeline IID $CI_PIPELINE_IID: $CI_PIPELINE_URL"
  script:
    - 'export PATH=$PATH:/opt/bin'
    # Package source code using ScanCentral client
    - 'scancentral package $PACKAGE_OPTS -o package.zip'
    # Start Fortify on Demand SAST scan
    - 'java -jar $FOD_UPLOAD -z package.zip -aurl $FOD_API_URL -purl $FOD_URL -rid "$FOD_RELEASE" -tc "$FOD_TENANT" -uc "$FOD_USER" "$FOD_PAT" $FOD_UPLOADER_OPTS -n "$FOD_NOTES"'
  allow_failure: true
